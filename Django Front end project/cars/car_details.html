<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/cars/css/car_details.css">
    <title>Car Details</title>
</head>
<body>
    <div id="navbar"></div>
    <div id="messages"></div>
    <div class="car-container" id="car-detail">
        <p style="text-align:center; color: #bbb;">Loading car details...</p>
    </div>
    <script>
        const BASE_URL = "http://127.0.0.1:8000"
        const params = new URLSearchParams(window.location.search)
        const carId = params.get("id")
        const messageDiv = document.getElementById("messages")
        function showMessage(message, color = "#2c6e2e", duration = 2000) {
            messageDiv.style.display = 'flex'
            messageDiv.style.opacity = '1'
            messageDiv.style.backgroundColor = color
            messageDiv.innerHTML = message

            setTimeout(() => {
                messageDiv.style.opacity = '0'
                setTimeout(() => {
                    messageDiv.style.display = 'none'
                }, 500)
            }, duration)
        }

        fetch(`${BASE_URL}/cars/api/cars/${carId}/`)
            .then(response => response.json())
            .then(car => {
                const container = document.getElementById("car-detail")
                container.innerHTML = ""

                const photos = [car.photo1, car.photo2, car.photo3].map(photo =>
                    photo.startsWith("http") ? photo : `${BASE_URL}${photo}`
                )

                let currentIndex = 0

                function showPhoto(index) {
                    const imgElement = document.getElementById("car-image")
                    imgElement.src = photos[index]
                    imgElement.alt = `${car.brand} ${car.model} ${index + 1}`
                }

                container.innerHTML = `
                    <h2>${car.brand} ${car.model}</h2>
                    <div class="img_div" style="text-align:center margin-top:20px">
                        <button id="prev-btn"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><g transform="translate(24,0) scale(-1,1)"><path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7H7l4 5l-4 5h6l4-5z"/></g></svg></button>
                        <img id="car-image" src="${photos[0]}" alt="${car.brand} ${car.model}" style="display:block margin:10px auto">
                        <button id="next-btn"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7H7l4 5l-4 5h6l4-5z"/></svg></button>
                    </div>
                    <div class="buttons"></div>
                    <div class="car_info"></div>
                `

                const buttons = document.querySelector(".buttons")
                const contactBtn = document.createElement("button")
                contactBtn.className = 'contact_button'
                contactBtn.innerHTML = "Contact Seller"
                buttons.appendChild(contactBtn)

                const rentBtn = document.createElement("a")
                rentBtn.className = "rent_button"
                if (car.is_available) {
                    rentBtn.href = `/cars/rent.html?id=${car.id}`
                    rentBtn.innerText = "Rent"
                } else {
                    rentBtn.href = "#"
                    rentBtn.innerText = "Not available"
                    rentBtn.onclick = (e) => {
                        e.preventDefault()
                        showMessage(`Sorry, ${car.brand} ${car.model} is not available right now.`, 'red')
                    }
                }
                buttons.appendChild(rentBtn)
                const carInfo = document.querySelector(".car_info")
                carInfo.innerHTML = `
                    <h3>Car Information</h3>
                    <div class="car-info-grid">
                        <p><strong>Brand:</strong></p><p>${car.brand}</p>
                        <p><strong>Model:</strong></p><p>${car.model}</p>
                        <p><strong>Year:</strong></p><p>${car.year}</p>
                        <p><strong>Daily Price:</strong></p><p>$${car.daily_price}</p>
                        <p><strong>Capacity:</strong></p><p>${car.capacity} persons</p>
                        <p><strong>Transmission:</strong></p><p>${car.transmission}</p>
                        <p><strong>Fuel Tank:</strong></p><p>${car.fuel_tank} L</p>
                        <p><strong>City:</strong></p><p>${car.city}</p>
                        <p><strong>License Plate:</strong></p><p>${car.license_plate}</p>
                        <p><strong>Times Rented:</strong></p><p>${car.rent_count}</p>
                        <p><strong>Available:</strong></p><p>${car.is_available ? "✅ Yes" : "❌ No"}</p>
                    </div>
                `

                document.getElementById("prev-btn").addEventListener("click", () => {
                    currentIndex = (currentIndex - 1 + photos.length) % photos.length
                    showPhoto(currentIndex)
                })

                document.getElementById("next-btn").addEventListener("click", () => {
                    currentIndex = (currentIndex + 1) % photos.length
                    showPhoto(currentIndex)
                })
            })
            .catch(error => {
                console.error("Error fetching car:", error)
                document.getElementById("car-detail").innerHTML = "<p style='text-align:center color:red'>Failed to load car details.</p>"
            })
    </script>


    <script src="/cars/navbar.js"></script>

</body>
</html>
